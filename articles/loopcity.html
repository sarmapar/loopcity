<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using loopcity • loopcity</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using loopcity">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">loopcity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/loopcity.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using loopcity</h1>
                        <h4 data-toc-skip class="author">Sarah
Parker</h4>
            
            <h4 data-toc-skip class="date">2025-07-27</h4>
      

      <div class="d-none name"><code>loopcity.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>This package can be installed via Github:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"remotes"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"sarmapar/loopcity"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="loopcity-pipeline">loopcity Pipeline<a class="anchor" aria-label="anchor" href="#loopcity-pipeline"></a>
</h2>
<p>While <code>loopcity</code> functions can be used in isolation, they
are more powerful used in sequence. There are 4 main steps to call
communities from a <code>.hic</code> file and a
<code>GInteractions</code> object of loops.</p>
<div class="section level3">
<h3 id="starting-with-a-loop-file">Starting with a loop file<a class="anchor" aria-label="anchor" href="#starting-with-a-loop-file"></a>
</h3>
<p>If you have a <code>.txt</code> file of loop calls, these can be
converted to a <code>GInteractions</code> object using the package
<code>mariner</code>. Loopcity requires loop anchors to be binned to the
same size, so loops can also be binned using <code>assignToBins</code>
which accepts a loop file, BEDPE-formatted ‘data.frame’-like object, or
GInteractions object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loopFile</span> <span class="op">&lt;-</span> <span class="st">"../data/GM12878_10KbLoops.txt"</span></span>
<span></span>
<span><span class="co">## To read in loop file as-is, use `as_ginteractions`</span></span>
<span><span class="va">loops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">loopFile</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mariner</span><span class="fu">::</span><span class="fu"><a href="http://ericscottdavis.com/mariner/reference/as_ginteractions.html" class="external-link">as_ginteractions</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## To bin loops to a certain size, use `assignToBins`</span></span>
<span><span class="va">loops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">loopFile</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mariner</span><span class="fu">::</span><span class="fu"><a href="http://ericscottdavis.com/mariner/reference/assignToBins.html" class="external-link">assignToBins</a></span><span class="op">(</span>binSize <span class="op">=</span> <span class="fl">10e3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-1-merge-loop-anchors-using-mergeanchors">Step 1: Merge Loop Anchors using <code>mergeAnchors</code><a class="anchor" aria-label="anchor" href="#step-1-merge-loop-anchors-using-mergeanchors"></a>
</h3>
<p>Since loop calling can be imprecise, using loop anchors as-is can
lead to multiple anchors representing one biologically relevant region.
By default, any duplicate loops created via this merging are dropped,
but these can be kept by setting <code>dropDups = F</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mergedLoops</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mergeAnchors.html">mergeAnchors</a></span><span class="op">(</span><span class="va">loops</span><span class="op">)</span></span></code></pre></div>
<p>In this example, since one bin is 10Kb and <code>pixelOverlap</code>
is 1 by default, all loop anchors within 1 pixel or 10Kb from each other
will be grouped and merged into one representative anchor. The most
common or the middle-most of these anchors is chosen as the new
representative position for all neighboring anchors. Increasing
<code>pixelOverlap</code> to <code>n</code> means all loop anchors
within <code>n</code> pixels, or <code>n</code> * <code>binSize</code>
base pairs will be merged into one position.</p>
<p>The output, <code>mergedLoops</code>, is a <code>GInteractions</code>
object with all the same information from <code>loops</code> but with
adjusted anchor positions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mergedLoops</span></span>
<span><span class="co">#&gt; GInteractions object with 175 interactions and 0 metadata columns:</span></span>
<span><span class="co">#&gt;         seqnames1           ranges1     seqnames2           ranges2</span></span>
<span><span class="co">#&gt;             &lt;Rle&gt;         &lt;IRanges&gt;         &lt;Rle&gt;         &lt;IRanges&gt;</span></span>
<span><span class="co">#&gt;     [1]        22 33910000-33920000 ---        22 34500000-34510000</span></span>
<span><span class="co">#&gt;     [2]        22 42360000-42370000 ---        22 42830000-42840000</span></span>
<span><span class="co">#&gt;     [3]        22 32920000-32930000 ---        22 33390000-33400000</span></span>
<span><span class="co">#&gt;     [4]        22 50320000-50330000 ---        22 50650000-50660000</span></span>
<span><span class="co">#&gt;     [5]        22 50710000-50720000 ---        22 51050000-51060000</span></span>
<span><span class="co">#&gt;     ...       ...               ... ...       ...               ...</span></span>
<span><span class="co">#&gt;   [171]        22 42090000-42100000 ---        22 42330000-42340000</span></span>
<span><span class="co">#&gt;   [172]        22 30680000-30690000 ---        22 30750000-30760000</span></span>
<span><span class="co">#&gt;   [173]        22 31020000-31030000 ---        22 31470000-31480000</span></span>
<span><span class="co">#&gt;   [174]        22 25630000-25640000 ---        22 25730000-25740000</span></span>
<span><span class="co">#&gt;   [175]        22 20760000-20770000 ---        22 20810000-20820000</span></span>
<span><span class="co">#&gt;   -------</span></span>
<span><span class="co">#&gt;   regions: 225 ranges and 0 metadata columns</span></span>
<span><span class="co">#&gt;   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-add-connections-using-connectloopanchors">Step 2: Add connections using <code>connectLoopAnchors</code><a class="anchor" aria-label="anchor" href="#step-2-add-connections-using-connectloopanchors"></a>
</h3>
<p>Since loop callers are limited to a binary classification of “loop”
or “not a loop”, we can instead create all possible loops and then
create a threshold of what should be kept as a “true” loop based on a
set of flexible parameters. The first step in this process is to create
a set of all possible loops. The <code>connectLoopAnchors</code>
function creates a new set of loops, connecting all anchors to every
anchor within <code>overlapDist</code>. In this example, all anchors
within 1Mb of each other are connected to create new loops.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connectLoopAnchors.html">connectLoopAnchors</a></span><span class="op">(</span><span class="va">mergedLoops</span>, overlapDist <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span></code></pre></div>
<p>This results in a new <code>GInteractions</code> object, with
original metadata removed and a new metadata column named “source” where
all interactions that were present in the original set of loops are
labeled as “original” and added loops are labeled as “added”.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connections</span></span>
<span><span class="co">#&gt; GInteractions object with 1523 interactions and 1 metadata column:</span></span>
<span><span class="co">#&gt;          seqnames1           ranges1     seqnames2           ranges2 |</span></span>
<span><span class="co">#&gt;              &lt;Rle&gt;         &lt;IRanges&gt;         &lt;Rle&gt;         &lt;IRanges&gt; |</span></span>
<span><span class="co">#&gt;      [1]        22 17400000-17410000 ---        22 17530000-17540000 |</span></span>
<span><span class="co">#&gt;      [2]        22 17400000-17410000 ---        22 17650000-17660000 |</span></span>
<span><span class="co">#&gt;      [3]        22 17400000-17410000 ---        22 17980000-17990000 |</span></span>
<span><span class="co">#&gt;      [4]        22 17400000-17410000 ---        22 18310000-18320000 |</span></span>
<span><span class="co">#&gt;      [5]        22 17530000-17540000 ---        22 17650000-17660000 |</span></span>
<span><span class="co">#&gt;      ...       ...               ... ...       ...               ... .</span></span>
<span><span class="co">#&gt;   [1519]        22 50930000-50940000 ---        22 51070000-51080000 |</span></span>
<span><span class="co">#&gt;   [1520]        22 50930000-50940000 ---        22 51130000-51140000 |</span></span>
<span><span class="co">#&gt;   [1521]        22 51050000-51060000 ---        22 51070000-51080000 |</span></span>
<span><span class="co">#&gt;   [1522]        22 51050000-51060000 ---        22 51130000-51140000 |</span></span>
<span><span class="co">#&gt;   [1523]        22 51070000-51080000 ---        22 51130000-51140000 |</span></span>
<span><span class="co">#&gt;               source</span></span>
<span><span class="co">#&gt;          &lt;character&gt;</span></span>
<span><span class="co">#&gt;      [1]    original</span></span>
<span><span class="co">#&gt;      [2]       added</span></span>
<span><span class="co">#&gt;      [3]    original</span></span>
<span><span class="co">#&gt;      [4]       added</span></span>
<span><span class="co">#&gt;      [5]       added</span></span>
<span><span class="co">#&gt;      ...         ...</span></span>
<span><span class="co">#&gt;   [1519]       added</span></span>
<span><span class="co">#&gt;   [1520]       added</span></span>
<span><span class="co">#&gt;   [1521]       added</span></span>
<span><span class="co">#&gt;   [1522]       added</span></span>
<span><span class="co">#&gt;   [1523]    original</span></span>
<span><span class="co">#&gt;   -------</span></span>
<span><span class="co">#&gt;   regions: 224 ranges and 0 metadata columns</span></span>
<span><span class="co">#&gt;   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-3-score-original-and-new-loops-using-scoreinteractions">Step 3: Score original and new loops using
<code>scoreInteractions</code><a class="anchor" aria-label="anchor" href="#step-3-score-original-and-new-loops-using-scoreinteractions"></a>
</h3>
<p>These added and original connections are then scored based on the
enrichment of the counts of the loop pixel compared to the local
background. The shape and size of this local background can be
customized using the parameters <code>bg</code> for the shape, and
<code>bgSize</code>, <code>bgGap</code>, and <code>fgSize</code> for the
size.</p>
<p>This normalizes contact counts between loop sizes, since shorter
loops typically have higher raw counts. To account for noise in long
range loops with low counts, a pseudocount value of 5 is added to all
raw counts before calculating an enrichment score. This pseudocount
value can be modified by changing the <code>pseudo</code> value.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hicFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GM12878_chr22.hic"</span>, package <span class="op">=</span> <span class="st">"loopcity"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu">scoreInteractions</span><span class="op">(</span><span class="va">connections</span>,</span>
<span>                            hicFile <span class="op">=</span> <span class="va">hicFile</span><span class="op">)</span></span>
<span><span class="co">#&gt; '0' = foreground;</span></span>
<span><span class="co">#&gt; 'X' = background;</span></span>
<span><span class="co">#&gt; '*' = both;</span></span>
<span><span class="co">#&gt; '-' = unselected</span></span>
<span><span class="co">#&gt;                                  </span></span>
<span><span class="co">#&gt;  X  X  X  X  X  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  X  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  X  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  X  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  X  0  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  0  0  0  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  0  X  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  X  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  X  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  X  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  X  X  X  X  X </span></span>
<span><span class="co">#&gt; '0' = foreground;</span></span>
<span><span class="co">#&gt; 'X' = background;</span></span>
<span><span class="co">#&gt; '*' = both;</span></span>
<span><span class="co">#&gt; '-' = unselected</span></span>
<span><span class="co">#&gt;                                  </span></span>
<span><span class="co">#&gt;  X  X  X  X  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  0  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  X  X  X  X</span></span></code></pre></div>
<p>This results in a new <code>InteractionArray</code> containing the
scores for all interactions and metadata such as the name of the .hic
file the counts came from and the number of pseudocounts added. To get
just the <code>GInteraction</code> object with the new
<code>score</code> column, we can run
<code>interactions(scores)</code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the `scores` object is an 'InteractionArray' containing extra metadata information</span></span>
<span><span class="va">scores</span> </span>
<span><span class="co">#&gt; class: InteractionArray </span></span>
<span><span class="co">#&gt; dim: 1523 interaction(s), 1 file(s), 11x11 count matrix(es)</span></span>
<span><span class="co">#&gt; metadata(3): binSize norm matrix</span></span>
<span><span class="co">#&gt; assays(3): counts rownames colnames</span></span>
<span><span class="co">#&gt; rownames: NULL</span></span>
<span><span class="co">#&gt; rowData names(2): source score</span></span>
<span><span class="co">#&gt; colnames(1): GM12878_chr22.hic</span></span>
<span><span class="co">#&gt; colData names(3): files fileNames pseudocounts</span></span>
<span><span class="co">#&gt; type: GInteractions</span></span>
<span><span class="co">#&gt; regions: 224</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the interactions of the `InteractionArray` gives back a `GInteractions` object</span></span>
<span><span class="fu">InteractionSet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/InteractionSet/man/interaction-accessors.html" class="external-link">interactions</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span></span>
<span><span class="co">#&gt; GInteractions object with 1523 interactions and 2 metadata columns:</span></span>
<span><span class="co">#&gt;          seqnames1           ranges1     seqnames2           ranges2 |</span></span>
<span><span class="co">#&gt;              &lt;Rle&gt;         &lt;IRanges&gt;         &lt;Rle&gt;         &lt;IRanges&gt; |</span></span>
<span><span class="co">#&gt;      [1]        22 17400000-17410000 ---        22 17530000-17540000 |</span></span>
<span><span class="co">#&gt;      [2]        22 17400000-17410000 ---        22 17650000-17660000 |</span></span>
<span><span class="co">#&gt;      [3]        22 17400000-17410000 ---        22 17980000-17990000 |</span></span>
<span><span class="co">#&gt;      [4]        22 17400000-17410000 ---        22 18310000-18320000 |</span></span>
<span><span class="co">#&gt;      [5]        22 17530000-17540000 ---        22 17650000-17660000 |</span></span>
<span><span class="co">#&gt;      ...       ...               ... ...       ...               ... .</span></span>
<span><span class="co">#&gt;   [1519]        22 50930000-50940000 ---        22 51070000-51080000 |</span></span>
<span><span class="co">#&gt;   [1520]        22 50930000-50940000 ---        22 51130000-51140000 |</span></span>
<span><span class="co">#&gt;   [1521]        22 51050000-51060000 ---        22 51070000-51080000 |</span></span>
<span><span class="co">#&gt;   [1522]        22 51050000-51060000 ---        22 51130000-51140000 |</span></span>
<span><span class="co">#&gt;   [1523]        22 51070000-51080000 ---        22 51130000-51140000 |</span></span>
<span><span class="co">#&gt;               source             score</span></span>
<span><span class="co">#&gt;          &lt;character&gt;   &lt;DelayedMatrix&gt;</span></span>
<span><span class="co">#&gt;      [1]    original  2.66666666666667</span></span>
<span><span class="co">#&gt;      [2]       added  1.30952380952381</span></span>
<span><span class="co">#&gt;      [3]    original  1.28571428571429</span></span>
<span><span class="co">#&gt;      [4]       added                 1</span></span>
<span><span class="co">#&gt;      [5]       added               1.1</span></span>
<span><span class="co">#&gt;      ...         ...               ...</span></span>
<span><span class="co">#&gt;   [1519]       added             1.125</span></span>
<span><span class="co">#&gt;   [1520]       added  1.28571428571429</span></span>
<span><span class="co">#&gt;   [1521]       added 0.867324561403509</span></span>
<span><span class="co">#&gt;   [1522]       added 0.895833333333333</span></span>
<span><span class="co">#&gt;   [1523]    original  1.33333333333333</span></span>
<span><span class="co">#&gt;   -------</span></span>
<span><span class="co">#&gt;   regions: 224 ranges and 0 metadata columns</span></span>
<span><span class="co">#&gt;   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-4-assign-anchors-and-loop-communities-using-assigncommunities">Step 4: Assign anchors and loop communities using
<code>assignCommunities</code><a class="anchor" aria-label="anchor" href="#step-4-assign-anchors-and-loop-communities-using-assigncommunities"></a>
</h3>
<p>The <code>GInteractions</code> object stored inside
<code>score</code> can then be used to assign communities. This function
builds a network where the nodes are each loop anchor and the edge
weights are the enrichment scores calculated in the previous step. By
default, all loops with a score less than the median score of original
loops are removed. This threshold is printed in a message and stored in
the metadata of the output object in a variable called
<code>pruningValue</code>. This value can be manually set by passing a
value to the <code>pruneUnder</code> parameter.</p>
<p>This network is then passed through a clustering algorithm. The
default algorithm is leiden, but other options include “fast_greedy”,
“walktrap”, “infomap”, “label_prop”, or “edge_betweenness”. This assigns
each loop anchor to a community, and any nodes that are closely
bordering a neighboring community are evaluated to determine if they
should be included in both communities. If the average score of the
border anchor and all anchors in the neighboring community is greater
than the average score of all interactions between all the anchors in
the current community, then the anchor is assigned to both the original
and neighboring community. Loops are assigned to a community if both
anchors of the loop are in the same community.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">communities</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assignCommunities.html">assignCommunities</a></span><span class="op">(</span><span class="fu">InteractionSet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/InteractionSet/man/interaction-accessors.html" class="external-link">interactions</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Pruning added loops with a score less than 1.48611111111111</span></span></code></pre></div>
<p>To see the pruning value used to remove edges from the network, run
the following code</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">S4Vectors</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Annotated-class.html" class="external-link">metadata</a></span><span class="op">(</span><span class="va">communities</span><span class="op">)</span><span class="op">$</span><span class="va">pruningValue</span></span>
<span><span class="co">#&gt; [1] 1.486111</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="full-workflow">Full Workflow<a class="anchor" aria-label="anchor" href="#full-workflow"></a>
</h3>
<p>These four functions can be combined into one step by piping the
results from one function into the next. This results in the same final
<code>GInteractions</code> object which contains the merged anchor
locations, enrichment scores for each loop, anchor communities, and loop
communities.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">communities</span> <span class="op">&lt;-</span> <span class="va">loops</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/mergeAnchors.html">mergeAnchors</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/connectLoopAnchors.html">connectLoopAnchors</a></span><span class="op">(</span>overlapDist <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">scoreInteractions</span><span class="op">(</span>hicFile <span class="op">=</span> <span class="va">hicFile</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">InteractionSet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/InteractionSet/man/interaction-accessors.html" class="external-link">interactions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/assignCommunities.html">assignCommunities</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; '0' = foreground;</span></span>
<span><span class="co">#&gt; 'X' = background;</span></span>
<span><span class="co">#&gt; '*' = both;</span></span>
<span><span class="co">#&gt; '-' = unselected</span></span>
<span><span class="co">#&gt;                                  </span></span>
<span><span class="co">#&gt;  X  X  X  X  X  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  X  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  X  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  X  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  X  0  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  0  0  0  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  0  X  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  X  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  X  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  X  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  X  X  X  X  X </span></span>
<span><span class="co">#&gt; '0' = foreground;</span></span>
<span><span class="co">#&gt; 'X' = background;</span></span>
<span><span class="co">#&gt; '*' = both;</span></span>
<span><span class="co">#&gt; '-' = unselected</span></span>
<span><span class="co">#&gt;                                  </span></span>
<span><span class="co">#&gt;  X  X  X  X  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  X  X  X  X  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  0  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  -  -  -  - </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  X  X  X  X </span></span>
<span><span class="co">#&gt;  -  -  -  -  -  -  -  X  X  X  X </span></span>
<span><span class="co">#&gt; Pruning added loops with a score less than 1.48611111111111</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-communities">Visualizing Communities<a class="anchor" aria-label="anchor" href="#visualizing-communities"></a>
</h3>
<p>We also provide a function to visualize these communities using the
final <code>GInteractions</code> object returned from
<code>assignCommunities</code> and a .hic file. This returns a pdf of
the given region(s), with each region on each page. The figure contains
a heatmap of hic counts with original loops annotated by black squares
and added loops annotated by grey squares and arches with their height
set to the calculated enrichment score colored by their assigned
community.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotHicCommunities.html">plotHicCommunities</a></span><span class="op">(</span>pdfName <span class="op">=</span> <span class="st">"plot.pdf"</span>, </span>
<span>                   communities <span class="op">=</span> <span class="va">communities</span>, </span>
<span>                   hicFile <span class="op">=</span> <span class="va">hicFile</span>,</span>
<span>                   norm <span class="op">=</span> <span class="st">"NONE"</span>,</span>
<span>                   chroms <span class="op">=</span> <span class="fl">22</span>, </span>
<span>                   starts <span class="op">=</span> <span class="fl">25e6</span>, </span>
<span>                   ends <span class="op">=</span> <span class="fl">30e6</span>,</span>
<span>                   zmax <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="img/plot.png" style="width:100.0%"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.1 (2025-06-13)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.2 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] loopcity_0.1.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] tidyselect_1.2.1            dplyr_1.1.4                </span></span>
<span><span class="co">#&gt;   [3] farver_2.1.2                bitops_1.0-9               </span></span>
<span><span class="co">#&gt;   [5] Biostrings_2.76.0           RCurl_1.98-1.17            </span></span>
<span><span class="co">#&gt;   [7] fastmap_1.2.0               GenomicAlignments_1.44.0   </span></span>
<span><span class="co">#&gt;   [9] XML_3.99-0.18               digest_0.6.37              </span></span>
<span><span class="co">#&gt;  [11] lifecycle_1.0.4             plyranges_1.28.0           </span></span>
<span><span class="co">#&gt;  [13] magrittr_2.0.3              dbscan_1.2.2               </span></span>
<span><span class="co">#&gt;  [15] compiler_4.5.1              progress_1.2.3             </span></span>
<span><span class="co">#&gt;  [17] rlang_1.1.6                 sass_0.4.10                </span></span>
<span><span class="co">#&gt;  [19] tools_4.5.1                 igraph_2.1.4               </span></span>
<span><span class="co">#&gt;  [21] yaml_2.3.10                 data.table_1.17.8          </span></span>
<span><span class="co">#&gt;  [23] rtracklayer_1.68.0          knitr_1.50                 </span></span>
<span><span class="co">#&gt;  [25] prettyunits_1.2.0           S4Arrays_1.8.1             </span></span>
<span><span class="co">#&gt;  [27] curl_6.4.0                  DelayedArray_0.34.1        </span></span>
<span><span class="co">#&gt;  [29] RColorBrewer_1.1-3          abind_1.4-8                </span></span>
<span><span class="co">#&gt;  [31] BiocParallel_1.42.1         HDF5Array_1.36.0           </span></span>
<span><span class="co">#&gt;  [33] withr_3.0.2                 purrr_1.1.0                </span></span>
<span><span class="co">#&gt;  [35] BiocGenerics_0.54.0         desc_1.4.3                 </span></span>
<span><span class="co">#&gt;  [37] grid_4.5.1                  stats4_4.5.1               </span></span>
<span><span class="co">#&gt;  [39] Rhdf5lib_1.30.0             ggplot2_3.5.2              </span></span>
<span><span class="co">#&gt;  [41] scales_1.4.0                SummarizedExperiment_1.38.1</span></span>
<span><span class="co">#&gt;  [43] cli_3.6.5                   rmarkdown_2.29             </span></span>
<span><span class="co">#&gt;  [45] crayon_1.5.3                ragg_1.4.0                 </span></span>
<span><span class="co">#&gt;  [47] generics_0.1.4              rjson_0.2.23               </span></span>
<span><span class="co">#&gt;  [49] httr_1.4.7                  cachem_1.1.0               </span></span>
<span><span class="co">#&gt;  [51] rhdf5_2.52.1                assertthat_0.2.1           </span></span>
<span><span class="co">#&gt;  [53] parallel_4.5.1              ggplotify_0.1.2            </span></span>
<span><span class="co">#&gt;  [55] restfulr_0.0.16             BiocManager_1.30.26        </span></span>
<span><span class="co">#&gt;  [57] XVector_0.48.0              matrixStats_1.5.0          </span></span>
<span><span class="co">#&gt;  [59] vctrs_0.6.5                 yulab.utils_0.2.0          </span></span>
<span><span class="co">#&gt;  [61] Matrix_1.7-3                jsonlite_2.0.0             </span></span>
<span><span class="co">#&gt;  [63] hms_1.1.3                   gridGraphics_0.5-1         </span></span>
<span><span class="co">#&gt;  [65] IRanges_2.42.0              S4Vectors_0.46.0           </span></span>
<span><span class="co">#&gt;  [67] systemfonts_1.2.3           h5mread_1.0.1              </span></span>
<span><span class="co">#&gt;  [69] strawr_0.0.92               jquerylib_0.1.4            </span></span>
<span><span class="co">#&gt;  [71] clustAnalytics_0.5.5        glue_1.8.0                 </span></span>
<span><span class="co">#&gt;  [73] pkgdown_2.1.3               plotgardener_1.14.0        </span></span>
<span><span class="co">#&gt;  [75] codetools_0.2-20            gtable_0.3.6               </span></span>
<span><span class="co">#&gt;  [77] GenomeInfoDb_1.44.1         BiocIO_1.18.0              </span></span>
<span><span class="co">#&gt;  [79] GenomicRanges_1.60.0        UCSC.utils_1.4.0           </span></span>
<span><span class="co">#&gt;  [81] tibble_3.3.0                pillar_1.11.0              </span></span>
<span><span class="co">#&gt;  [83] htmltools_0.5.8.1           rhdf5filters_1.20.0        </span></span>
<span><span class="co">#&gt;  [85] GenomeInfoDbData_1.2.14     R6_2.6.1                   </span></span>
<span><span class="co">#&gt;  [87] mariner_1.2.1               textshaping_1.0.1          </span></span>
<span><span class="co">#&gt;  [89] Rdpack_2.6.4                evaluate_1.0.4             </span></span>
<span><span class="co">#&gt;  [91] lattice_0.22-7              Biobase_2.68.0             </span></span>
<span><span class="co">#&gt;  [93] rbibutils_2.3               Rsamtools_2.24.0           </span></span>
<span><span class="co">#&gt;  [95] bslib_0.9.0                 colourvalues_0.3.9         </span></span>
<span><span class="co">#&gt;  [97] Rcpp_1.1.0                  InteractionSet_1.36.1      </span></span>
<span><span class="co">#&gt;  [99] SparseArray_1.8.1           xfun_0.52                  </span></span>
<span><span class="co">#&gt; [101] fs_1.6.6                    MatrixGenerics_1.20.0      </span></span>
<span><span class="co">#&gt; [103] pkgconfig_2.0.3</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sarah Parker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
